<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AK Motivation v3.7 ‚Äî Modal & Background Fixed</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg1:#021026;--bg2:#07193a;--muted:#b8c7db;--accent:#6ee7ff;--accent2:#9b6bff}
*{box-sizing:border-box;font-family:Poppins, 'Noto Sans Devanagari', system-ui, sans-serif}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6eef8}
/* Aurora background (below content) */
.aurora{position:fixed;inset:0;z-index:0;pointer-events:none;background:
  radial-gradient(600px 200px at 10% 10%, rgba(155,107,255,0.12), transparent 10%),
  radial-gradient(500px 160px at 90% 20%, rgba(110,231,255,0.08), transparent 10%),
  linear-gradient(180deg, rgba(15,23,42,0.35), transparent 35%);
filter:blur(18px);animation:float 12s ease-in-out infinite}
@keyframes float{0%{transform:translateY(-6px)}50%{transform:translateY(6px)}100%{transform:translateY(-6px)}}

.container{position:relative;z-index:2;max-width:1100px;margin:28px auto;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:#021026;font-weight:800}
.title{font-size:18px;margin:0}
.subtitle{color:var(--muted);font-size:13px;margin-top:4px}
.controls{display:flex;gap:10px;align-items:center}
.search{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;min-width:220px}

.tabs{display:flex;gap:8px;margin:12px 0 18px 0;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid transparent;cursor:pointer;color:var(--muted);font-weight:600}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#021026;box-shadow:0 8px 30px rgba(155,107,255,0.12)}

.layout{display:grid;grid-template-columns:1fr 340px;gap:24px;align-items:start}
@media(max-width:980px){ .layout{grid-template-columns:1fr} .logo{width:48px;height:48px} .search{min-width:140px}}

.list{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,8,23,0.4);cursor:pointer;transition:transform .2s,box-shadow .2s}
.card:hover{transform:translateY(-6px) scale(1.01);box-shadow:0 20px 60px rgba(2,8,23,0.6)}
.card img{width:100%;height:200px;object-fit:cover;border-radius:10px;margin-bottom:10px}
.txt{font-size:15px;color:#eaf4ff;line-height:1.6;white-space:pre-wrap}

.actions{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.leftmeta{color:var(--muted);font-size:13px}
.rightbtns{display:flex;gap:8px}
.iconbtn{padding:8px 10px;border-radius:9px;border:none;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));color:inherit;cursor:pointer;font-weight:700}

/* modal/backdrop now above everything */
.backdrop{display:none;position:fixed;inset:0;z-index:9999;background:rgba(1,4,12,0.7);align-items:center;justify-content:center;padding:20px}
.modal{background:linear-gradient(180deg,#071428,#0b2238);max-width:980px;width:100%;border-radius:14px;overflow:hidden;box-shadow:0 30px 100px rgba(2,6,23,0.8);animation:pop .22s;position:relative;z-index:10000}
.modal img{width:100%;height:440px;object-fit:contain;background:#000}
.modal .content{padding:22px;max-height:70vh;overflow:auto}
.modal h2{margin:0 0 8px 0;font-size:22px;color:#e6f6ff}
.modal p{font-size:18px;line-height:1.8;color:#eaf4ff;white-space:pre-wrap}
.modal .foot{display:flex;justify-content:space-between;align-items:center;padding:14px;border-top:1px solid rgba(255,255,255,0.03)}

/* smaller add/edit modal */
.addmodal{max-width:760px;padding:14px}

/* sidebar/dashboard */
.sidebar{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:13px;color:#e8f4ff}
.table th{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#021026;border:none}

.footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px;padding-bottom:40px}
.hidden{display:none}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#021026;color:#eaf4ff;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .2s;z-index:12000}
</style>
</head>
<body>
<div class="aurora" aria-hidden></div>

<div class="container" id="appContainer">
  <header class="header">
    <div class="brand"><div class="logo">AK</div><div><div class="title">AK Motivation</div><div class="subtitle">‡§∂‡§æ‡§Ø‡§∞‡•Ä ¬∑ ‡§µ‡§ø‡§ö‡§æ‡§∞ ¬∑ ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ</div></div></div>
    <div class="controls">
      <input id="search" class="search" placeholder="‡§ñ‡•ã‡§ú‡•á‡§Ç ‚Äî ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ, ‡§∂‡§æ‡§Ø‡§∞‡•Ä..." />
      <div id="ownerArea"></div>
    </div>
  </header>

  <div class="tabs" id="tabs">
    <div class="tab" data-tab="quotes">‡§µ‡§ø‡§ö‡§æ‡§∞</div>
    <div class="tab" data-tab="stories">‡§ï‡§π‡§æ‡§®‡§ø‡§Ø‡§æ‡§Å</div>
    <div class="tab active" data-tab="shayari">Shayari Zone</div>
    <div class="tab" data-tab="lines">‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å</div>
    <div class="tab" data-tab="images">Images</div>
    <div class="tab hidden" data-tab="dashboard" id="dashboardTab">Dashboard</div>
  </div>

  <div class="layout">
    <main>
      <div id="list" class="list" aria-live="polite"></div>

      <div id="dashboardArea" class="hidden" style="margin-top:14px">
        <div class="sidebar">
          <h3 style="margin:0 0 8px 0">Owner Dashboard</h3>
          <table class="table" id="dashTable"><thead><tr><th>Item</th><th>Likes</th><th>Shares</th><th>Views</th></tr></thead><tbody></tbody></table>
          <div style="margin-top:8px"><button id="exportBtn" class="iconbtn">Export JSON</button></div>
        </div>
      </div>
    </main>

    <aside class="sidebar">
      <h4 style="margin:0 0 8px 0">Shayari Categories</h4>
      <div id="categoryTabs" style="display:flex;flex-direction:column;gap:8px"></div>
      <div style="margin-top:12px">
        <button id="addBtn" class="iconbtn hidden">+ Add</button>
        <button id="addCatBtn" class="iconbtn hidden" style="margin-left:8px">+ Category</button>
      </div>
      <div style="margin-top:14px;color:var(--muted);font-size:13px">Owner-only: Add / Edit / Delete / Dashboard</div>
    </aside>
  </div>

  <div class="footer">AK Motivation ‚Ä¢ v3.7 ‚Äî Fixed</div>
</div>

<!-- Add/Edit Modal (high z-index) -->
<div id="addBackdrop" class="backdrop" aria-hidden>
  <div class="modal addmodal" role="dialog" aria-modal="true">
    <div style="padding:12px">
      <h3 id="modalTitle">Add Item</h3>
      <form id="form">
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <select id="typeSel" style="padding:8px;border-radius:8px"><option value="shayari">Shayari</option><option value="quotes">Quotes</option><option value="stories">Stories</option><option value="lines">Lines</option><option value="images">Image Only</option></select>
          <input id="title" placeholder="Title (optional)" style="padding:8px;border-radius:8px"/>
          <textarea id="text" rows="6" placeholder="Text (leave empty for image-only)" style="padding:8px;border-radius:8px"></textarea>
          <input id="author" placeholder="Author (optional)" style="padding:8px;border-radius:8px"/>
          <input id="tags" placeholder="Tags, comma" style="padding:8px;border-radius:8px"/>
          <input id="imageInput" type="file" accept="image/*"/>
          <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
            <button type="button" id="cancelBtn" class="iconbtn">Cancel</button>
            <button type="submit" class="iconbtn">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Reader Modal (high z-index) -->
<div id="readerBackdrop" class="backdrop" aria-hidden>
  <div class="modal" role="dialog" aria-modal="true">
    <div id="readerImageWrap"></div>
    <div class="content">
      <h2 id="readerTitle"></h2>
      <p id="readerText"></p>
    </div>
    <div class="foot">
      <div id="readerMeta" style="color:var(--muted)"></div>
      <div style="display:flex;gap:8px">
        <button id="readerLike" class="iconbtn">‚ù§ Like</button>
        <button id="readerCopy" class="iconbtn">üìã Copy</button>
        <button id="readerShare" class="iconbtn">üîó Share</button>
        <button id="readerEdit" class="iconbtn hidden">Edit</button>
        <button id="readerClose" class="iconbtn">Close</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Copied</div>

<script>
// Owner credentials
const OWNER = 'akimran', PASS = '143143', STORAGE = 'ak_v3_7_storage_v1';
const AUTO_LOGOUT_MS = 3 * 60 * 1000;

// default data
const defaultData = {
  quotes:[{id:1,text:'‡§∏‡§™‡§®‡•á ‡§µ‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã ‡§Ü‡§™ ‡§∏‡•ã‡§§‡•á ‡§µ‡§ï‡•ç‡§§ ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‚Äî ‡§∏‡§™‡§®‡•á ‡§µ‡•ã ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•ã‡§®‡•á ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡•á‡•§',author:'‚Äî A.P.J. Abdul Kalam',likes:12,shares:2,views:10,image:null}],
  stories:[],
  lines:[],
  shayari:{
    "Couple Shayari":[{id:11,text:'‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•á ‡§¨‡§ø‡§®‡§æ ‡§Ö‡§ß‡•Ç‡§∞‡•Ä ‡§∏‡•Ä ‡§Æ‡•á‡§∞‡•Ä ‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π',author:'‚Äî ‡§Ö‡§®‡§ú‡§æ‡§®',likes:3,shares:0,views:5,image:null}],
    "Attitude Shayari":[{id:12,text:'‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§∞‡§æ‡§π ‡§ñ‡•Å‡§¶ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å ‚Äî ‡§§‡•Å‡§ù‡•á ‡§¶‡•á‡§ñ ‡§ï‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¶‡§≤‡§§‡§æ‡•§',author:'‚Äî',likes:1,shares:0,views:2,image:null}],
    "Friendship Shayari":[{id:13,text:'‡§¶‡•ã‡§∏‡•ç‡§§‡•Ä ‡§µ‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã ‡§∏‡§æ‡§• ‡§Æ‡•á‡§Ç ‡§π‡§Å‡§∏‡§æ‡§§‡•Ä ‡§π‡•à, ‡§¶‡•ã‡§∏‡•ç‡§§‡§ø ‡§§‡•ã ‡§µ‡•ã ‡§π‡•ã‡§§‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§Å‡§∏‡•Ç ‡§™‡•ã‡§Ç‡§õ ‡§≤‡•á‡§§‡•Ä ‡§π‡•à‡•§',author:'‚Äî',likes:2,shares:0,views:3,image:null}],
    "Rishte Shayari":[{id:14,text:'‡§∞‡§ø‡§∂‡•ç‡§§‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§¶‡§∞ ‡§ï‡§∞‡•ã ‚Äî ‡§Ø‡§π‡•Ä ‡§ú‡•Ä‡§µ‡§® ‡§ï‡§æ ‡§Ö‡§∏‡§≤‡•Ä ‡§ß‡§® ‡§π‡•à‡•§',author:'‚Äî',likes:2,shares:0,views:3,image:null}]
  },
  images:[],
  categories:["Couple Shayari","Attitude Shayari","Friendship Shayari","Rishte Shayari"],
  settings:{daily:{type:'quotes',id:1}}
};

// state
let db = load(), active='shayari', owner=false, lastActivity = Date.now(), currentItem = null;

// helpers
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

function load(){ try{ const raw = localStorage.getItem(STORAGE); if(raw) return JSON.parse(raw); }catch(e){} localStorage.setItem(STORAGE, JSON.stringify(defaultData)); return JSON.parse(JSON.stringify(defaultData)); }
function save(){ localStorage.setItem(STORAGE, JSON.stringify(db)); }

// init
renderOwnerArea();
rebuildCategories();
renderList();
attachEvents();

function attachEvents(){
  $$('#tabs .tab').forEach(t=> t.addEventListener('click', (e)=>{ $$('#tabs .tab').forEach(x=>x.classList.remove('active')); e.currentTarget.classList.add('active'); active = e.currentTarget.dataset.tab; renderList(); }));
  $('#search').addEventListener('input', debounce(renderList,200));
  $('#addBtn').addEventListener('click', openAddModal);
  $('#cancelBtn').addEventListener('click', closeAddModal);
  $('#form').addEventListener('submit', onSave);
  $('#imageInput').addEventListener('change', handleImageSelect);
  $('#readerClose').addEventListener('click', closeReader);
  $('#readerLike').addEventListener('click', ()=>{ if(currentItem){ currentItem.likes = (currentItem.likes||0)+1; save(); updateReaderMeta(); renderList(); } });
  $('#readerShare').addEventListener('click', ()=>{ if(currentItem){ currentItem.shares = (currentItem.shares||0)+1; save(); updateReaderMeta(); copy(generateUrl(active,currentItem.id)); showToast('Link copied'); renderList(); } });
  $('#readerCopy').addEventListener('click', ()=>{ if(currentItem){ copy(currentItem.text||currentItem.content||''); showToast('Copied'); } });
  $('#addCatBtn').addEventListener('click', ()=>{ if(!owner) return alert('Owner only'); const name = prompt('New category name'); if(!name) return; if(db.categories.includes(name)) return alert('Category exists'); db.categories.push(name); db.shayari[name]=[]; save(); rebuildCategories(); showToast('Category added'); });
  $('#exportBtn').addEventListener('click', ()=>{ const a=document.createElement('a'); const blob=new Blob([JSON.stringify(db,null,2)],{type:'application/json'}); a.href=URL.createObjectURL(blob); a.download='ak_backup_v3_7.json'; a.click(); });
  window.addEventListener('mousemove', updateLastActivity); window.addEventListener('keydown', updateLastActivity);
  setInterval(()=>{ if(!owner) return; if(Date.now()-lastActivity > AUTO_LOGOUT_MS){ doLogout(); alert('Auto-logout due to inactivity (3 minutes)'); } }, 1000);
}

function renderOwnerArea(){
  const area = $('#ownerArea'); area.innerHTML='';
  if(sessionStorage.getItem('ak_owner_active')){ owner=true; }
  if(owner){
    const s = document.createElement('span'); s.textContent = 'Owner: '+OWNER; s.style.marginRight='8px';
    const btn = document.createElement('button'); btn.className='iconbtn'; btn.textContent='Logout'; btn.addEventListener('click', ()=>{ doLogout(); });
    area.appendChild(s); area.appendChild(btn); $('#addBtn').classList.remove('hidden'); $('#addCatBtn').classList.remove('hidden'); $('#dashboardTab').classList.remove('hidden'); buildDashboard();
  } else {
    const btn = document.createElement('button'); btn.className='iconbtn'; btn.textContent='Owner Login'; btn.addEventListener('click', ()=> showLogin()); area.appendChild(btn); $('#addBtn').classList.add('hidden'); $('#addCatBtn').classList.add('hidden'); $('#dashboardTab').classList.add('hidden'); $('#dashboardArea').classList.add('hidden');
  }
}

function showLogin(){ const u = prompt('Owner Username:'); if(u===null) return; const p = prompt('Password:'); if(p===null) return; if(u===OWNER && p===PASS){ owner = true; sessionStorage.setItem('ak_owner_active','1'); lastActivity = Date.now(); renderOwnerArea(); renderList(); buildDashboard(); alert('Owner mode on'); } else alert('Invalid'); }
function doLogout(){ owner=false; sessionStorage.removeItem('ak_owner_active'); renderOwnerArea(); renderList(); alert('Logged out'); }

function rebuildCategories(){
  const wrap = $('#categoryTabs'); wrap.innerHTML='';
  (db.categories||[]).forEach(cat=>{ const b=document.createElement('button'); b.className='iconbtn'; b.textContent = cat; b.style.display='block'; b.addEventListener('click', ()=>{ active='shayari'; renderList(cat); }); wrap.appendChild(b); });
}

function renderList(cat){
  const list = $('#list'); list.innerHTML='';
  const q = ($('#search').value||'').toLowerCase().trim();
  let items = [];
  if(active==='quotes') items = db.quotes || [];
  else if(active==='stories') items = db.stories || [];
  else if(active==='lines') items = db.lines || [];
  else if(active==='shayari') items = (cat ? db.shayari[cat]||[] : db.shayari[db.categories[0]]||[]);
  else if(active==='images') items = db.images || [];
  items = items.filter(it=> { const txt = ((it.title||'')+' '+(it.text||it.content||'')+' '+(it.author||'')).toLowerCase(); return q ? txt.includes(q) : true; });
  if(items.length===0){ $('#list').innerHTML = '<div style="color:var(--muted)">‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</div>'; return; }
  items.forEach(it=>{
    const card = document.createElement('div'); card.className='card';
    if(it.image){ const img = document.createElement('img'); img.src = it.image; card.appendChild(img); }
    if((it.text||it.content) && !(active==='images' && !it.text && it.image)){ const p = document.createElement('div'); p.className='txt'; p.textContent = it.title ? (it.title + '\n' + (it.content||it.text||'')) : (it.text||it.content||''); card.appendChild(p); }
    const actions = document.createElement('div'); actions.className='actions';
    const left = document.createElement('div'); left.className='leftmeta'; left.textContent = it.author ? it.author : '';
    const right = document.createElement('div'); right.className='rightbtns';
    const like = document.createElement('button'); like.className='iconbtn'; like.textContent = '‚ù§ ' + (it.likes||0);
    like.addEventListener('click', (e)=>{ e.stopPropagation(); it.likes = (it.likes||0)+1; save(); renderList(); });
    const share = document.createElement('button'); share.className='iconbtn'; share.textContent='üîó'; share.title='Share'; share.addEventListener('click',(e)=>{ e.stopPropagation(); it.shares = (it.shares||0)+1; save(); copy(generateUrl(active,it.id)); showToast('Link copied'); renderList(); });
    const copyBtn = document.createElement('button'); copyBtn.className='iconbtn'; copyBtn.textContent='üìã'; copyBtn.title='Copy link'; copyBtn.addEventListener('click',(e)=>{ e.stopPropagation(); copy(generateUrl(active,it.id)); showToast('Link copied'); });
    right.appendChild(like); right.appendChild(share); right.appendChild(copyBtn);
    actions.appendChild(left); actions.appendChild(right);
    card.appendChild(actions);
    card.addEventListener('click', ()=> openReader(it));
    list.appendChild(card);
  });
  if(owner) buildDashboard();
}

function openReader(it){
  it.views = (it.views||0) + 1; save();
  currentItem = it;
  $('#readerImageWrap').innerHTML = '';
  if(it.image){ const img = document.createElement('img'); img.src = it.image; $('#readerImageWrap').appendChild(img); }
  $('#readerTitle').textContent = it.title || '';
  $('#readerText').textContent = (it.content || it.text || '') + (it.author ? '\n\n' + it.author : '');
  $('#readerMeta').textContent = `Likes: ${it.likes||0} ‚Ä¢ Shares: ${it.shares||0} ‚Ä¢ Views: ${it.views||0}`;
  $('#readerEdit').classList.toggle('hidden', !owner);
  $('#readerBackdrop').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  history.pushState({},'', generateUrl(active,it.id));
}

function closeReader(){ $('#readerBackdrop').style.display = 'none'; currentItem = null; document.body.style.overflow = ''; history.pushState({}, '', location.pathname); }

// Add modal helpers (fixed layering + scroll lock)
function openAddModal(){ $('#addBackdrop').style.display = 'flex'; document.body.style.overflow = 'hidden'; $('#modalTitle').textContent = 'Add Item'; $('#form').reset(); $('#imageInput').value=''; $('#imageInput').dataset.base64=''; }
function closeAddModal(){ $('#addBackdrop').style.display = 'none'; document.body.style.overflow = ''; }

function handleImageSelect(e){ const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = (ev)=>{ $('#imageInput').dataset.base64 = ev.target.result; showToast('Image selected'); }; r.readAsDataURL(f); }

function onSave(e){ e.preventDefault(); if(!sessionStorage.getItem('ak_owner_active')){ alert('Only owner can add'); closeAddModal(); return; } const type = $('#typeSel').value; const title = $('#title').value.trim(); const text = $('#text').value.trim(); const author = $('#author').value.trim(); const tags = ($('#tags').value||'').split(',').map(s=>s.trim()).filter(Boolean); const img = $('#imageInput').dataset.base64 || null;
  const obj = { id: Date.now(), likes:0, shares:0, views:0, tags: tags, image: img };
  if(type==='quotes'){ obj.text = text; obj.author = author; db.quotes.unshift(obj); }
  else if(type==='stories'){ obj.title = title; obj.content = text; db.stories.unshift(obj); }
  else if(type==='lines'){ obj.text = text; db.lines.unshift(obj); }
  else if(type==='shayari'){ obj.text = text; obj.author = author; const cat = prompt('Choose category name (existing or new):', db.categories[0]); if(!cat) return alert('Category required'); if(!db.categories.includes(cat)){ db.categories.push(cat); db.shayari[cat]=[]; } db.shayari[cat].unshift(obj); }
  else if(type==='images'){ obj.text = text || ''; if(!db.images) db.images=[]; db.images.unshift(obj); }
  save(); closeAddModal(); renderList(); rebuildCategories(); showToast('Saved'); }

function showToast(msg){ const t = document.getElementById('toast'); t.textContent = msg; t.style.opacity = 1; setTimeout(()=> t.style.opacity = 0, 1600); }
function copy(text){ try{ navigator.clipboard.writeText(text); }catch(e){ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); } }
function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t = setTimeout(()=> fn(...a), ms); }; }

function generateUrl(t,id){ const url = new URL(location.href); url.searchParams.set('t', t); url.searchParams.set('id', id); return url.toString(); }

function buildDashboard(){ if(!sessionStorage.getItem('ak_owner_active')) return; $('#dashboardArea').classList.remove('hidden'); const tbody = $('#dashTable tbody'); tbody.innerHTML = ''; const rows = []; (db.quotes||[]).forEach(it=> rows.push({title:(it.text||'').slice(0,60),likes:it.likes||0,shares:it.shares||0,views:it.views||0})); (db.stories||[]).forEach(it=> rows.push({title:(it.title||'').slice(0,60),likes:it.likes||0,shares:it.shares||0,views:it.views||0})); Object.keys(db.shayari||{}).forEach(cat=> (db.shayari[cat]||[]).forEach(it=> rows.push({title:(it.text||'').slice(0,60),likes:it.likes||0,shares:it.shares||0,views:it.views||0}))); (db.images||[]).forEach(it=> rows.push({title:'Image',likes:it.likes||0,shares:it.shares||0,views:it.views||0})); rows.forEach(r=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td>${escapeHtml(r.title)}</td><td>${r.likes}</td><td>${r.shares}</td><td>${r.views}</td>`; tbody.appendChild(tr); }); }

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// initial load and query open
(function(){ const params = new URLSearchParams(location.search); const t = params.get('t'); const id = params.get('id'); if(t && id){ let found=null; if(t==='quotes') found = (db.quotes||[]).find(x=>String(x.id)===String(id)); if(t==='stories') found = (db.stories||[]).find(x=>String(x.id)===String(id)); if(t==='lines') found = (db.lines||[]).find(x=>String(x.id)===String(id)); if(t==='shayari'){ for(const c of db.categories||[]){ const f = (db.shayari[c]||[]).find(x=>String(x.id)===String(id)); if(f){ found=f; break; } } } if(t==='images') found = (db.images||[]).find(x=>String(x.id)===String(id)); if(found) setTimeout(()=> openReader(found), 300); } })();

// load/save (expose for debug)
function load(){ try{ const raw = localStorage.getItem(STORAGE); if(raw) return JSON.parse(raw); }catch(e){} localStorage.setItem(STORAGE, JSON.stringify(defaultData)); return JSON.parse(JSON.stringify(defaultData)); }
function save(){ localStorage.setItem(STORAGE, JSON.stringify(db)); }

// expose for debug
window.db = db; window.saveDB = save;
</script>
</body>
</html>
