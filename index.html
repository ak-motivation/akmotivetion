<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üåÖ AK Motivation Portal</title>
  <style>
    /* ====== Basic & Fonts ====== */
    :root{
      --sunrise-1: #fff6e6;
      --sunrise-2: #ffd6a5;
      --accent: #ff7a2d;
      --card: rgba(255,255,255,0.88);
      --muted: #575757;
      --glass: rgba(255,255,255,0.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Noto Sans Devanagari', 'Segoe UI', Roboto, sans-serif;-webkit-font-smoothing:antialiased}
    body{color:#222;background:linear-gradient(180deg,var(--sunrise-1),var(--sunrise-2));overflow-y:auto;transition:background .5s}

    /* ====== Scene (sun + soft clouds) ====== */
    .scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
    .horizon{position:absolute;left:0;right:0;bottom:0;height:40vh;background:
      linear-gradient(180deg, rgba(255,200,140,0.06), rgba(255,140,60,0.06));pointer-events:none}
    .sun-wrap{position:absolute;left:50%;transform:translateX(-50%);bottom:-15vh;width:100%;display:flex;justify-content:center;align-items:flex-end}
    .sun{
      width:240px;height:240px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #fff7e8 0%, #ffd08a 40%, #ffb066 70%, #ff8a2d 100%);
      filter:blur(6px);
      box-shadow:0 30px 90px rgba(255,120,30,0.18), inset 0 -10px 30px rgba(255,255,255,0.25);
      transform:translateY(0);
      transition:transform 2.6s ease-in-out;
    }
    /* sun rises: we will animate transform translateY negative to bring it up */
    .sun.rise{transform: translateY(-22vh) scale(1.02); transition: transform 3.2s cubic-bezier(.2,.9,.2,1);}

    .cloud{
      position:absolute;
      background:linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.85));
      border-radius:50px;
      filter:blur(0.4px);
      opacity:0.95;
    }
    .cloud.c1{width:260px;height:70px;left:6%;top:10%;animation:cloudfloat 40s linear infinite}
    .cloud.c2{width:180px;height:56px;left:68%;top:8%;animation:cloudfloat 52s linear infinite}
    .cloud.c3{width:200px;height:60px;left:32%;top:22%;animation:cloudfloat 46s linear infinite}
    @keyframes cloudfloat{0%{transform:translateX(0)}50%{transform:translateX(40px)}100%{transform:translateX(0)}}

    /* ====== Layout ====== */
    .wrap{position:relative;z-index:2;max-width:1100px;margin:28px auto;padding:22px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:68px;height:68px;border-radius:14px;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#ffffffaa,#ffffff33);box-shadow:0 10px 30px rgba(0,0,0,0.08)
    }
    .brand h1{margin:0;font-size:22px;color:var(--accent);letter-spacing:0.2px}
    .brand p{margin:0;font-size:12px;color:var(--muted)}

    .controls{display:flex;gap:8px;align-items:center}
    .search{padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);min-width:200px}
    .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#ff9b4a);color:#fff;box-shadow:0 8px 20px rgba(255,120,30,0.15)}
    .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}

    /* main layout two-columns */
    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px;align-items:start}
    .card{background:var(--card);backdrop-filter: blur(6px);border-radius:12px;padding:14px;box-shadow:0 12px 34px rgba(9,10,10,0.06)}
    .left{position:sticky;top:22px;height:fit-content}
    .daily{font-style:italic;padding:12px;border-radius:10px;background:linear-gradient(90deg,#fff7e1,#fff3db);margin-bottom:12px}
    .meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:13px;color:var(--muted)}

    /* tabs */
    .tabs{display:flex;gap:10px;margin-bottom:12px}
    .tab{padding:8px 14px;border-radius:999px;cursor:pointer;border:1px solid transparent}
    .tab.active{background:linear-gradient(90deg,rgba(255,255,255,0.95),rgba(255,255,255,0.9));box-shadow:0 8px 24px rgba(0,0,0,0.06);border-color:rgba(0,0,0,0.04)}

    /* list */
    .list .item{padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);margin-bottom:10px;background:linear-gradient(180deg,rgba(255,255,255,0.92),rgba(255,255,255,0.86))}
    .item .title{font-weight:700;color:#333}
    .item .text{margin-top:8px;color:#333}
    .item .item-meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .small-btn{padding:6px 8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;cursor:pointer}

    /* modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(6,6,6,0.45);z-index:60;padding:18px}
    .modal .box{background:white;padding:16px;border-radius:12px;max-width:720px;width:100%}
    .form-row{margin-top:10px}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);font-size:15px}
    textarea{min-height:110px;resize:vertical}

    /* footer */
    footer{text-align:center;margin-top:18px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:880px){
      .layout{grid-template-columns:1fr}
      .left{order:2;position:static}
      .brand h1{font-size:18px}
    }

    /* dark mode (optional) */
    body.dark{background:linear-gradient(180deg,#0b1220,#071022);color:#e7eef9}
    body.dark .card{background:rgba(255,255,255,0.03)}
    body.dark .list .item{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
  <!-- Scene -->
  <div class="scene" aria-hidden>
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>

    <div class="sun-wrap">
      <div id="sun" class="sun" aria-hidden></div>
    </div>

    <div class="horizon"></div>
  </div>

  <!-- App -->
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden>
          <svg width="46" height="46" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="24" height="24" rx="5" fill="#ffffff" opacity="0.14"/>
            <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-size="10" font-weight="700" fill="#ff7a2d">AK</text>
          </svg>
        </div>
        <div>
          <h1>üåÖ AK Motivation Portal</h1>
          <p>‡§π‡§∞ ‡§¶‡§ø‡§® ‡§è‡§ï ‡§õ‡•ã‡§ü‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‚Äî ‡§ï‡§π‡§æ‡§®‡§ø‡§Ø‡§æ‡§Å ‚Ä¢ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‚Ä¢ ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å</p>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="search" placeholder="‡§ñ‡•ã‡§ú‡•á‡§Ç: ‡§â‡§¶‡§æ. ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ, ‡§∏‡§´‡§≤‡§§‡§æ..." />
        <button id="addBtn" class="btn primary">+ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
        <button id="exportBtn" class="btn ghost">Export</button>
        <label class="btn ghost" style="display:inline-flex;align-items:center;gap:8px;cursor:pointer">
          Import <input id="imp" type="file" accept="application/json" style="display:none">
        </label>
        <button id="themeToggle" class="btn ghost" title="‡§•‡•Ä‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç">üåó</button>
      </div>
    </header>

    <main class="layout">
      <!-- Left column -->
      <aside class="left card">
        <div class="daily" id="dailyCard">
          <div id="dailyContent">"‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§Æ‡•å‡§ï‡§æ ‡§π‡•à ‡§ñ‡•Å‡§¶ ‡§ï‡•ã ‡§¨‡•á‡§π‡§§‡§∞ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡§æ‡•§"</div>
          <div class="meta-row">
            <small id="dailyType">‚Äî</small>
            <div style="display:flex;gap:8px">
              <button id="newDaily" class="small-btn">‡§®‡§Ø‡§æ</button>
              <button id="favDaily" class="small-btn">Fav</button>
            </div>
          </div>
        </div>

        <div style="font-weight:700;margin-bottom:8px">Tags</div>
        <div id="tagList" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px"></div>

        <div style="font-weight:700;margin-bottom:8px">Quick Actions</div>
        <div style="display:flex;gap:8px;flex-direction:column">
          <button id="resetBtn" class="small-btn">Reset to Default</button>
          <button id="clearAll" class="small-btn">‡§∏‡§≠‡•Ä ‡§π‡§ü‡§æ‡§è‡§Å</button>
        </div>
      </aside>

      <!-- Right column -->
      <section class="card" style="min-height:420px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div class="tabs" role="tablist" aria-label="Tabs">
            <div class="tab active" data-tab="stories">‡§ï‡§π‡§æ‡§®‡§ø‡§Ø‡§æ‡§Å</div>
            <div class="tab" data-tab="quotes">‡§µ‡§ø‡§ö‡§æ‡§∞</div>
            <div class="tab" data-tab="lines">‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <select id="filterTag" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
              <option value="">‡§∏‡§≠‡•Ä ‡§ü‡•à‡§ó</option>
            </select>
            <div style="font-size:13px;color:var(--muted)">‡§ï‡•Å‡§≤: <span id="count">0</span></div>
          </div>
        </div>

        <div id="list" class="list"></div>
      </section>
    </main>

    <footer>AK Motivation ‚Ä¢ Offline-ready ‚Ä¢ LocalStorage ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§</footer>
  </div>

  <!-- Modal (Add / Edit) -->
  <div id="modal" class="modal" style="display:none">
    <div class="box">
      <h3 id="modalTitle">‡§®‡§Ø‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
      <form id="form">
        <div class="form-row">
          <label>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</label>
          <select id="typeSel">
            <option value="stories">‡§ï‡§π‡§æ‡§®‡•Ä</option>
            <option value="quotes">‡§µ‡§ø‡§ö‡§æ‡§∞</option>
            <option value="lines">‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø</option>
          </select>
        </div>

        <div class="form-row" id="fieldTitle" style="display:none">
          <label>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</label>
          <input id="title" type="text" placeholder="‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï (‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è)" />
        </div>

        <div class="form-row">
          <label id="labelText">‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü</label>
          <textarea id="text" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç..."></textarea>
        </div>

        <div class="form-row">
          <label>‡§≤‡•á‡§ñ‡§ï / ‡§∏‡•ç‡§∞‡•ã‡§§ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</label>
          <input id="author" type="text" placeholder="‡§≤‡•á‡§ñ‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ" />
        </div>

        <div class="form-row">
          <label>Tags (‡§ï‡•â‡§Æ‡§æ ‡§∏‡•á ‡§Ö‡§≤‡§ó ‡§ï‡§∞‡•á‡§Ç)</label>
          <input id="tags" type="text" placeholder="‡§â‡§¶‡§æ. ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ, ‡§∏‡§´‡§≤‡§§‡§æ" />
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button type="button" id="cancel" class="small-btn">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
          <button type="submit" class="btn primary">‡§∏‡§π‡•á‡§ú‡•á‡§Ç</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    /* ========= App logic (single-file) ========= */
    const STORAGE_KEY = 'ak_motivation_v2';

    // default data
    const defaultData = {
      stories:[
        {id:1,title:'‡§õ‡•ã‡§ü‡§æ ‡§ï‡§¶‡§Æ, ‡§¨‡§°‡§º‡•Ä ‡§ú‡•Ä‡§§',content:'‡§è‡§ï ‡§õ‡•ã‡§ü‡•á ‡§∏‡•á ‡§ó‡§æ‡§Ç‡§µ ‡§ï‡§æ ‡§≤‡§°‡§º‡§ï‡§æ ‡§∞‡•ã‡§ú‡§º ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞‡§§‡§æ ‡§∞‡§π‡§æ‡•§ ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡•á‡§π‡§®‡§§ ‡§∞‡§Ç‡§ó ‡§≤‡§æ‡§à ‡§î‡§∞ ‡§â‡§∏‡§®‡•á ‡§Ö‡§™‡§®‡•á ‡§∏‡§™‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§ø‡§Ø‡§æ ‡§∏‡§æ‡§ï‡§æ‡§∞‡•§',tags:['‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ'],fav:false}
      ],
      quotes:[
        {id:1,text:'‡§ï‡§∞‡•ç‡§Æ ‡§π‡•Ä ‡§™‡•Ç‡§ú‡§æ ‡§π‡•à‡•§',author:'‚Äî ‡§Ö‡§®‡§ú‡§æ‡§®',tags:['‡§ï‡§∞‡•ç‡§Æ','‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ'],fav:false}
      ],
      lines:[
        {id:1,text:'‡§π‡§æ‡§∞ ‡§Æ‡§§ ‡§Æ‡§æ‡§®‡•ã, ‡§Ü‡§ú ‡§ï‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§≤ ‡§ï‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§π‡•à‡•§',tags:['‡§π‡§ø‡§Æ‡•ç‡§Æ‡§§'],fav:false}
      ],
      settings:{theme:'light',daily:{type:'quotes',id:1}}
    };

    // state
    let db = load();
    let activeTab = 'stories';
    let editing = null;

    // refs
    const listEl = document.getElementById('list');
    const tabs = document.querySelectorAll('.tab');
    const searchEl = document.getElementById('search');
    const addBtn = document.getElementById('addBtn');
    const modal = document.getElementById('modal');
    const form = document.getElementById('form');
    const typeSel = document.getElementById('typeSel');
    const titleEl = document.getElementById('title');
    const textEl = document.getElementById('text');
    const authorEl = document.getElementById('author');
    const tagsEl = document.getElementById('tags');
    const fieldTitle = document.getElementById('fieldTitle');
    const labelText = document.getElementById('labelText');
    const filterTag = document.getElementById('filterTag');
    const tagList = document.getElementById('tagList');
    const dailyContent = document.getElementById('dailyContent');
    const dailyType = document.getElementById('dailyType');
    const newDailyBtn = document.getElementById('newDaily');
    const favDailyBtn = document.getElementById('favDaily');
    const exportBtn = document.getElementById('exportBtn');
    const imp = document.getElementById('imp');
    const resetBtn = document.getElementById('resetBtn');
    const clearAll = document.getElementById('clearAll');
    const countEl = document.getElementById('count');
    const sun = document.getElementById('sun');
    const themeToggle = document.getElementById('themeToggle');

    // initialize
    applyTheme();
    attach();
    rebuildTagFilter();
    renderList();
    renderDaily();
    animateSunriseDaily(); // start sun animation

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) return JSON.parse(raw);
      }catch(e){console.error(e)}
      localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultData));
      return JSON.parse(JSON.stringify(defaultData));
    }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

    function attach(){
      tabs.forEach(t=>t.addEventListener('click', ()=>{ tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active'); activeTab = t.dataset.tab; renderList(); }));
      addBtn.addEventListener('click', openNew);
      searchEl.addEventListener('input', debounce(renderList,250));
      filterTag.addEventListener('change', renderList);
      typeSel.addEventListener('change', onTypeChange);
      document.getElementById('cancel').addEventListener('click', closeModal);
      form.addEventListener('submit', onSave);
      newDailyBtn.addEventListener('click', pickDaily);
      favDailyBtn.addEventListener('click', toggleDailyFav);
      exportBtn.addEventListener('click', exportJSON);
      imp.addEventListener('change', handleImport);
      resetBtn.addEventListener('click', resetToDefault);
      clearAll.addEventListener('click', clearEverything);
      themeToggle.addEventListener('click', toggleTheme);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal();});
    }

    function renderList(){
      const q = (searchEl.value||'').trim().toLowerCase();
      const ftag = filterTag.value;
      let arr = db[activeTab] || [];
      if(ftag){ arr = arr.filter(it => (it.tags||[]).includes(ftag)); }
      if(q){ arr = arr.filter(it => ((it.title||'')+' '+(it.text||'')+' '+(it.content||'')).toLowerCase().includes(q)); }
      listEl.innerHTML = '';
      countEl.textContent = arr.length;
      if(arr.length===0){ listEl.innerHTML = '<div style="color:var(--muted)">‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§®‡§Ø‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§</div>'; return; }

      arr.forEach(it=>{
        const div = document.createElement('div'); div.className='item';
        if(activeTab==='stories'){
          div.innerHTML = `<div class="title">${escapeHtml(it.title||'Untitled')}</div><div class="text">${escapeHtml(it.content||'')}</div>`;
        } else {
          div.innerHTML = `<div class="text">"${escapeHtml(it.text||'')}"</div><div style="margin-top:8px;color:var(--muted)">${escapeHtml(it.author||'')}</div>`;
        }
        // tags
        const tagWrap = document.createElement('div'); tagWrap.style.marginTop='8px';
        (it.tags||[]).forEach(t=>{ const s=document.createElement('span'); s.className='small-btn'; s.style.marginRight='6px'; s.style.padding='6px'; s.textContent=t; s.addEventListener('click', ()=>{ filterTag.value=t; renderList(); }); tagWrap.appendChild(s); });
        div.appendChild(tagWrap);

        // actions
        const meta = document.createElement('div'); meta.className='item-meta';
        const left = document.createElement('div'); left.style.fontSize='13px';
        left.textContent = it.fav ? '‚òÖ Favorite' : '';
        const actions = document.createElement('div');
        actions.style.display='flex'; actions.style.gap='8px';
        const editBtn = document.createElement('button'); editBtn.className='small-btn'; editBtn.textContent='Edit'; editBtn.addEventListener('click', ()=>openEdit(it));
        const delBtn = document.createElement('button'); delBtn.className='small-btn'; delBtn.textContent='Delete'; delBtn.addEventListener('click', ()=>{ if(confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')){ db[activeTab]=db[activeTab].filter(x=>x.id!==it.id); save(); rebuildTagFilter(); renderList(); renderDaily(); }});
        const favBtn = document.createElement('button'); favBtn.className='small-btn'; favBtn.textContent = it.fav ? 'Unfav' : 'Fav'; favBtn.addEventListener('click', ()=>{ it.fav = !it.fav; save(); renderList(); });
        const copyBtn = document.createElement('button'); copyBtn.className='small-btn'; copyBtn.textContent='Copy'; copyBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(activeTab==='stories' ? `${it.title}\n\n${it.content}` : (it.text||'')); alert('Copied to clipboard')});

        actions.append(editBtn, delBtn, favBtn, copyBtn);
        meta.append(left, actions);
        div.appendChild(meta);

        listEl.appendChild(div);
      });
    }

    function openNew(){
      editing = null;
      document.getElementById('modalTitle').textContent='‡§®‡§Ø‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç';
      form.reset();
      typeSel.value = activeTab;
      onTypeChange();
      modal.style.display='flex';
      titleEl.focus();
    }
    function openEdit(item){
      editing = {...item};
      document.getElementById('modalTitle').textContent='‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç';
      typeSel.value = activeTab;
      onTypeChange();
      if(activeTab==='stories'){ titleEl.value = item.title; textEl.value = item.content || ''; }
      else { titleEl.value=''; textEl.value = item.text || (item.content||''); }
      authorEl.value = item.author || '';
      tagsEl.value = (item.tags||[]).join(',');
      modal.style.display='flex';
    }
    function closeModal(){ modal.style.display='none'; editing=null; }

    function onTypeChange(){
      const t = typeSel.value;
      if(t==='stories'){ fieldTitle.style.display='block'; labelText.textContent='‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£'; }
      else { fieldTitle.style.display='none'; labelText.textContent='‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü'; }
    }

    function onSave(e){
      e.preventDefault();
      const type = typeSel.value;
      const tagArr = (tagsEl.value||'').split(',').map(s=>s.trim()).filter(Boolean);
      if(type==='stories'){
        if(!titleEl.value.trim() || !textEl.value.trim()){ alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§î‡§∞ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§≠‡§∞‡•á‡§Ç'); return; }
        if(editing){ db.stories = db.stories.map(s => s.id===editing.id ? {...s, title:titleEl.value, content:textEl.value, tags:tagArr} : s); }
        else { db.stories.unshift({ id: Date.now(), title: titleEl.value, content: textEl.value, tags: tagArr, fav:false }); }
      } else if(type==='quotes'){
        if(!textEl.value.trim()){ alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç'); return; }
        if(editing){ db.quotes = db.quotes.map(s => s.id===editing.id ? {...s, text:textEl.value, author:authorEl.value, tags:tagArr} : s); }
        else { db.quotes.unshift({ id: Date.now(), text: textEl.value, author: authorEl.value, tags: tagArr, fav:false }); }
      } else if(type==='lines'){
        if(!textEl.value.trim()){ alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§≤‡§ø‡§ñ‡•á‡§Ç'); return; }
        if(editing){ db.lines = db.lines.map(s => s.id===editing.id ? {...s, text:textEl.value, tags:tagArr} : s); }
        else { db.lines.unshift({ id: Date.now(), text: textEl.value, tags: tagArr, fav:false }); }
      }
      save(); rebuildTagFilter(); renderList(); renderDaily(); closeModal();
    }

    function rebuildTagFilter(){
      const tags = new Set();
      [...db.stories, ...db.quotes, ...db.lines].forEach(i => (i.tags||[]).forEach(t => tags.add(t)));
      filterTag.innerHTML = '<option value="">‡§∏‡§≠‡•Ä ‡§ü‡•à‡§ó</option>';
      tagList.innerHTML = '';
      tags.forEach(t => {
        const o = document.createElement('option'); o.value = t; o.textContent = t; filterTag.appendChild(o);
        const b = document.createElement('button'); b.className='small-btn'; b.textContent=t; b.addEventListener('click', ()=>{ filterTag.value = t; renderList(); }); tagList.appendChild(b);
      });
    }

    function pickDaily(){
      const pool = [];
      if(db.stories.length) pool.push({type:'stories', id: randomItem(db.stories).id});
      if(db.quotes.length) pool.push({type:'quotes', id: randomItem(db.quotes).id});
      if(db.lines.length) pool.push({type:'lines', id: randomItem(db.lines).id});
      if(pool.length===0){ alert('‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'); return; }
      const sel = pool[Math.floor(Math.random()*pool.length)];
      db.settings.daily = sel; save(); renderDaily();
    }
    function randomItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function renderDaily(){
      const d = db.settings.daily || {};
      if(!d.type){ dailyContent.textContent = '‡§ï‡•É‡§™‡§Ø‡§æ "‡§®‡§Ø‡§æ" ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§Ü‡§ú ‡§ï‡§æ ‡§™‡•ç‡§∞‡•á‡§∞‡§ï ‡§ö‡§Ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'; dailyType.textContent = ''; return; }
      const col = db[d.type] || [];
      const it = col.find(x=>x.id===d.id);
      if(!it){ dailyContent.textContent = '‡§ö‡§Ø‡§®‡§ø‡§§ ‡§Ü‡§á‡§ü‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§'; dailyType.textContent=''; return; }
      if(d.type==='stories'){ dailyContent.innerHTML = `<strong>${escapeHtml(it.title)}</strong><div style="margin-top:8px">${escapeHtml(it.content||it.text)}</div>`; }
      else { dailyContent.innerHTML = `<div style="font-style:italic">"${escapeHtml(it.text||it.content)}"</div><div style="margin-top:8px;color:var(--muted)">${escapeHtml(it.author||'')}</div>`; }
      dailyType.textContent = d.type==='stories' ? '‡§ï‡§π‡§æ‡§®‡•Ä' : (d.type==='quotes' ? '‡§µ‡§ø‡§ö‡§æ‡§∞' : '‡§™‡§Ç‡§ï‡•ç‡§§‡§ø');
    }

    function toggleDailyFav(){
      const d = db.settings.daily || {};
      if(!d.type){ alert('‡§™‡§π‡§≤‡•á Daily ‡§ö‡•Å‡§®‡•á‡§Ç'); return; }
      const col = db[d.type] || [];
      const it = col.find(x=>x.id===d.id);
      if(it){ it.fav = !it.fav; save(); renderDaily(); renderList(); }
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(db,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'ak_motivation_backup.json'; a.click(); URL.revokeObjectURL(url);
    }
    function handleImport(e){
      const f = e.target.files[0]; if(!f) return;
      const r = new FileReader(); r.onload = ev => {
        try{ db = JSON.parse(ev.target.result); save(); rebuildTagFilter(); renderList(); renderDaily(); alert('Import ‡§∏‡§´‡§≤'); } catch(err){ alert('Invalid JSON'); }
      }; r.readAsText(f);
    }

    function resetToDefault(){
      if(confirm('Reset ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡§≠‡•Ä custom data ‡§π‡§ü‡•á‡§Ç‡§ó‡•á, ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç?')){ db = JSON.parse(JSON.stringify(defaultData)); save(); rebuildTagFilter(); renderList(); renderDaily(); alert('Reset ‡§π‡•Å‡§Ü'); }
    }
    function clearEverything(){
      if(confirm('‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')){ db.stories=[]; db.quotes=[]; db.lines=[]; save(); rebuildTagFilter(); renderList(); renderDaily(); alert('‡§∏‡§´‡§æ‡§à ‡§π‡•Å‡§à'); }
    }

    function toggleTheme(){
      db.settings.theme = db.settings.theme === 'light' ? 'dark' : 'light'; save(); applyTheme();
    }
    function applyTheme(){
      if(db.settings && db.settings.theme === 'dark'){ document.body.classList.add('dark'); } else { document.body.classList.remove('dark'); }
    }

    // sunrise animation logic:
    // we simulate daily sunrise: on first load of the day we animate sun rising.
    // store lastAnimatedDate in localStorage to animate once per day.
    function animateSunriseDaily(){
      try{
        const key = 'ak_sun_last';
        const last = localStorage.getItem(key);
        const today = (new Date()).toISOString().slice(0,10);
        // if not animated today -> add 'rise' class after tiny delay
        setTimeout(()=>{
          sun.classList.add('rise');
          // create a subtle glow increase
          setTimeout(()=> sun.style.filter = 'blur(6px) drop-shadow(0 30px 90px rgba(255,120,30,0.22))', 600);
        }, 350);
        // store today's date
        if(last !== today){ localStorage.setItem(key, today); }
      }catch(e){ console.warn('sun animation fail', e); }
    }

    /* helpers */
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

  </script>
</body>
</html>
